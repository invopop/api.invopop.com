#

## Introduction

Invopop partners with the local technology provider [InvoiceXpress](https://invoicexpress.com/) to issue invoices, invoice-receipts, and credit notes in Portugal and allow users to submit their tax reports to the Portuguese tax authority (AT).

This guide will walk you through the steps necessary to set up a workflow to let you issue invoices in Portugal using the InvoiceXpress provider.

Please refer to the docs of the [GOBL's Portugal Tax Regime](https://github.com/invopop/gobl/blob/main/regimes/pt/README.md) to learn about the specifics of Portuguese GOBL documents and to get examples.

## Prerequisites

To issue invoices in Portugal via InvoiceXpress, you will need:

* Supplier details, including:

  * name,

  * Tax ID (*N√∫mero de Identifica√ß√£o Fiscal)*

  * address, and,

  * email

* Line item details including quantities, prices, applicable tax rates.

## Setup

There are three key processes to prepare:

* connect the InvoiceXpress Portugal app,

* create a supplier registration workflow,

* prepare an invoicing workflow.

<Steps>
  <Step title="Connect the InvoiceXpress app">
    Enter the **Configuration** section, then click on **Apps**. Click on the **Connect** button of the **InvoiceXpress Portugal** app.
  </Step>
  <Step title="Create a supplier registration workflow">
    We'll now create a workflow that you'll use to register companies within InvoiceXpress, before we can issue invoices with them. Back in the **Workflows** section, create a new "Contacts" workflow called "Register supplier in InvoiceXpress".

    The new workflow will need to perform three steps:

    * **Sign the Envelope**

    * **Register InvoiceXpress issuer**

    * **Set State** - with configuration set to `processing`.

    Add any additional steps you may need, and save the new workflow. You can also just copy the example workflow below.
    
    <Accordion title="Supplier post-registration workflow example">
      Copy and paste the following example in the workflow editor:

      ```json
      {
    "name": "Register in InvoiceXpress",
    "description": " ",
    "steps": [
        {
            "id": "e78ab920-b8be-11ef-9825-f56714a03659",
            "name": "Sign Envelope",
            "provider": "silo.close"
        },
        {
            "id": "01d3e8a0-499e-11ef-b4fe-47a6daefa429",
            "name": "Set State",
            "config": {
                "state": "processing"
            },
            "summary": "Set state to `processing`{.state .processing}",
            "provider": "silo.state"
        },
        {
            "id": "dbac1680-b8be-11ef-9825-f56714a03659",
            "name": "Register InvoiceXpress issuer",
            "provider": "invoicexpress.register",
            "next": [
                {
                    "status": "KO",
                    "step_id": "12ad6a70-499e-11ef-b4fe-47a6daefa429"
                }
            ]
        },
        {
            "id": "0eb04c30-499e-11ef-b4fe-47a6daefa429",
            "name": "Set State",
            "next": [
                {
                    "stop": true,
                    "status": "NA"
                }
            ],
            "config": {
                "state": "registered"
            },
            "summary": "Set state to `registered`{.state .registered}",
            "provider": "silo.state"
        },
        {
            "id": "12ad6a70-499e-11ef-b4fe-47a6daefa429",
            "name": "Set State",
            "config": {
                "state": "error"
            },
            "summary": "Set state to `error`{.state .error}",
            "provider": "silo.state"
        }
    ]
}
      ```
    </Accordion>
  </Step>

  <Step title="Prepare Invoice Workflow">
    Finally, we need to prepare the actual workflow that will be used to process invoices. For this example, the workflow should be named something like ‚ÄúSend invoice to InvoiceXpress‚Äù, and it will consist of the following Steps:

    * **Send to InvoiceXpress**.

    * **Generate PDF**¬†- configured for your environment.

    * **Set State**¬†- to ‚Äúsent‚Äù.
  </Step>
</Steps>

## Running

### Sandbox Environment

InvoiceXpress provides a way to configure their accounts to use the AT's sandbox environment so that you can test the issuance of invoices and credit notes end-to-end without fiscal or legal consequences. If you wish to use this environment, please contact us via Slack or [support@invopop.com](mailto:support@invopop.com) and we will walk you through the setup process.

### Setting up a new supplier

The InvoiceXpress provider supports multiple suppliers: you can use the same workflow with all of your suppliers. Each supplier will get their own InvoiceXpress account, which they will have to configure and, later, use for tax reporting.

These are the steps to enable a given supplier to issue documents:

<Steps>
  <Step title="Send the supplier data">

First, you need to send a [GOBL Party](https://docs.gobl.org/draft-0/org/party) document with the supplier information to the **supplier registration workflow** you configured in the setup section. As a result, the first address in the `emails` list will receive an invitation to the newly created account in InvoiceXpress.

&#x20;InvoicXpress will send an email included in the supplier document InvoiceXpress we'll create a new InvoiceXpress account for the supplier and invite the first user to it. The email&#x20;

The following is an example of a GOBL Party document with the minimal supplier information that you need to provide:

<Accordion title="Supplier example" defaultOpen={false}>

</Accordion>

Noteworthy remarks:

* The `uuid` attribute will identify the supplier's account. It is possible to have multiple accounts for the same supplier; you just need to use a different UUID for each one.

* Once the account is created and the first user is invited, the workflow job will move to the `QUEUED` status. It will stay in that status until the user completes the account configuration (as described in the next step below) when it will move to `OK`.

  </Step>

  <Step title="Configure the InvoiceXpress account">

The user invited to the new account will now have to log in to InvoiceXpress and complete the account's configuration.

An account will be ready to issue invoices once a default sequence is registered in the AT. This guide from InvoiceXpress' documentation explains how to do it:

üìò [Step by Step Guide to Create and Register Sequences](https://invoicexpress.helpscoutdocs.com/article/219-step-by-step-guide-to-creating-and-registering-series) (in English)

üìò [Guia passo a passo para criar e registar s√©ries e obter o ATCUD](https://invoicexpress.helpscoutdocs.com/article/212-atcud-guia-passo-a-passo-para-criar-e-registar-series) (in Portuguese with videos)

Noteworthy remarks:

* You'll find a pre-created sequence in the account pending to be registered. You can register and use that one, or create a different one, as you prefer.

* In any case, you must ensure the sequence you want to use is the default one in the account. Currently, only the default series can be used to issue documents.
  </Step>
</Steps>

#### Realtime tax reporting to the AT

Now, you may also want to enable real-time communication of invoices, transport documents, or both to the AT. This is an optional step, as you may prefer to send periodic SAF-T reports to the tax authorities. The following guide explains how to enable real-time communication:

üìò [Como criar Utilizador no Portal das Finan√ßas para Comunica√ß√£o Autom√°tica](https://invoicexpress.helpscoutdocs.com/article/92-como-crio-um-sub-utilizador-no-portal-das-financas) (in Portuguese only)

### And you're done!

At this point, the InvoiceXpress account will be ready to issue documents. To make that happen, you'll need to send [GOBL Invoice](https://docs.gobl.org/draft-0/bill/invoice) documents, according to the specs of [the PT regime](https://github.com/invopop/gobl/blob/main/regimes/pt/README.md), to the same workflow you created in the previous section, making sure the `supplier`'s UUID and Tax ID Code are the ones you set when you sent the GOBL Party document to create the account.

Also, the account's user can now export SAF-T reports directly from the InvoiceXpress UI or, if they prefer, configure real-time tax communication. This guide describes how:

üìó [Como criar Utilizador no Portal das Finan√ßas para Comunica√ß√£o Autom√°tica](https://invoicexpress.helpscoutdocs.com/article/92-como-crio-um-sub-utilizador-no-portal-das-financas)